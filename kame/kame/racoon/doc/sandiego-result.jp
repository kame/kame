Mon Jan 10 2000 - Fri Jan 14 2000

vs microsoft
    as responder
	phase 1の最後のパケットを再送してくる。kame側のstate machineの
	null pointer checkが足りず落ちた。明日再挑戦。

	再挑戦、うまくいった
		phase 1: pre-shared/3des/sha1/dh2
		phase 2: esp/sha/des/600sec/3kb

vs bluesteel
	うまくいったらしい。

	うまくいかなかった。
	initiator: 鍵できたけど ping しても向こうが返事せず。
		再戦予定
	transport やろうとしたら敵が tunnel mode をネゴってた。
	tunnel の時は敵が内側のアドレスを間違ってた。
	と言う分けで OK.
	phase 1: pre-shared/md5/des/dh1/10min
	phase 2: esp/md5/des/10min

	やっぱりネゴったポリシを突っ込む方が楽っす…

vs racoon
	rekey問題を解決したあと
	- phase 2を5秒に1回rekey
	- phase 1を8秒に1回rekey
	などのいじめをしているが、おおむね快調。
	たまにphase 2の失敗がある(pingしてると10秒くらい穴があく)。

	chargenとかも並行して試しているが問題なし。

	kernel codeにmemory leakはほとんどない模様。
	racoon内にmemory leakがある模様。動かしてると太る。

	IPv6もIPv4同様ちゃんと動いてます(ただしglobal address)。

	phase 1がaggressive modeのとき、rekeyに失敗しやすい。
	(phase 1を待ってphase 2が再開しない)

vs ashley laurent
	phase 1 userfqdn supportいれてよんと言われた。今回間に合うのかな。

	userfqdn 入れて再戦しようとしたけど、敵が tunnel mode の client あり
	しかサポートしてないので、明日再戦予定。

vs ericsson
	initiator: 既知のDH groupについてはDH group typeをつけてはいけない
	responder: blowfish、およびkey lengthをちゃんとサポートしないとまずい

	修正後ok(size=2000のpingまで)
		phase 1: pre-shared/des/md5/dh1/lifetime 1hour/lifebyte 1MB
		phase 2: esp/md5/blowfish 56bit/lifetime 1hour/lifebyte 1MB

	delete payloadを受けてもこっちはphase 1を保持しつづけているが、
	あっちはphase 1もきれたと思ってる。

vs ibm
	先方で試したところ、agressive modeにinterop issueがあるらしい。
	13日にv4/v6ともテスト予定。

	IPv4: ok
		phase 1 3des/md5/dh1/3600sec
		phase 2 esp/transport/des/sha1/dh2/1800sec

vs radguard
	gateway: いまいち。原因不明。
		こっちinitiate: policyのあがりかたがまずい/phase 1 2とも
			いまいち
		こっちrespond: phase 1 2ともいまいち。先方gateway裏のnodeから
			pingが届かない

		phase 1: pre-shared/des/md5/dh1
		phase 2: esp tun(裏)/3des/sha1/dh2
	client: ばっちり、ただし先方にfragment問題あり(ping > 1500答えなし)
		phase 1: pre-shared/3des/sha1/dh2
		phase 2: esp tun(自分自身)/3des/sha1/dh2

	base mode やろうよって言ったら持って来てないから、
	うちのテストサイト www.ip-sec.com でテストしてみてって言われる。
	見たけど base mode のかけらもないぞ。

vs network associates
	base mode:
		initiator/responder: psk
		PSK の HASH_R の計算は RFC2409 だよと諭される…
		治して phase1 ok. 
		phase2 で向こうに no proposal choosen. と言われる。
		md5/sha1 x des/3des, esp, transport のはずなんだけど…
		チェックしてもらってる最中。

	ふつうの: ばっちり、rekey放題もばっちり
		phase 1: pre-shared/sha1/3des/dh2/10min
		phase 2: esp/md5/cast128/dh2/5min
	明日dh5をやる予定。(1/12)
	dh5成功。(1/13)
	agressive modeもやった。

	こっちがわ、byte lifetimeに虫あり。つねに設定の1024倍のproposalを
	投げる。
	さらにlifetimeに虫。

vs intel
	base mode: initiator/responder共に敵がHASHの計算間違っているらしい。
		再戦予定。

vs freeswan
	group 5: phase1 ok.
	phase2 で PFS してるのに KE が出ない時がある。
	大量にracoon.conf書いて起動すると落ちずにパースに失敗する時がある。
	結果、変な値が入る時がある。KEが出ないのはこのせい。

	racoon.conf を少なめにして再挑戦。
	今度は KE 出したのに失敗。
	freeswan は informational exchange しないので、何が起きたかわからない。

	phase2 のproposalを6個書いたら SPI=0 で出していた。
	とりあえず少なめに書いて再挑戦。

	phase2 でPFSを使った時は SA の group description を
	書かないとエラーになる。

	治してok. thanx hugh!
	phase1: psk/sha1/3des/dh5/10min
	phase2: esp/3des/md5/dh1/10min

vs ire
	ipcomp over ikeのテスト
	spiまわりなどたくさん直した。2byte spiが来たときの対処等。
	現状のcodeはwell-known cpiをつっこまれると困る。
	phase 1: 3des/sha1/dh1/600s
	phase 2: esp/transport/3des/sha1/300s, ipcomp/deflate/300s

	いちおう動きそう。再試験予定。

vs cisco

テストするには
	psk.txtにエントリ追加。
	samples/Makefileに相手のentryを追加、生成。
	生成されたconfig fileを適宜いじる。

	tunnel modeの場合はけっこいろいろいじらないと駄目かも。

kame
	kernelのmbuf/key management memoryのleakはほとんど皆無。いくらでも
	続けられます。racoonは太ったりふんづけたり? とにぎやか。

	bundleについて:
	- proposalいっこについてtransformいっこになるようなconfig fileでないと
	  動かない。つまり、
		proposal { protocol ah; protocol esp; }
	  はいいが
		proposal { protocol esp; protocol esp; }
	  や、strengthの使用は不可。

	ときどきacquireまわりのtroubleでrekeyしなくなることがある。
	bundle使っていないときも似た症状が出るが、bundleを使うとさらに
	起きやすい気がする。
	(socket policyにrequireと書いた場合に、acquireが上がらないことが多い)

	acquireをuserland側でフィルタするところで、フィルタしすぎに
	なることがある。(ネゴるべきなのにネゴらない)

	kernelでah use/esp useと書いてあるのにracoon側でespしかネゴしなかった
	場合、永遠にahのacquireが上がり続ける。
	で、ahのacquireがあがったにも係わらず、racoonはespのネゴをするので
	永久にネゴが続く。
	- kernel policyとracoon policyの整合性 - racoonがkernelに
	  ポリシをつっこめばよい
	- acquireの細かいチェック - ahが要求されているのにespをネゴらないように
	が必要。

	byte lifetime問題。
	- 片方向だけたくさんtrafficがあると、片方向だけexpireする。
	  で、ネゴすると逆側はちっともexpireしないので鍵がたくさん溜っていく。
	- パケットロスがあると、出し側はexpireするのに受け側はexpireしない
	  場合がある。(問題にはならないと思うが)

	どっちの挙動が望ましいのか?
	racoon: lifetime、こっち側のconfig fileに関係なくネゴした結果を
		kernelにいれる。
	nai pgp client: lifetimeのネゴは普通に通すが、kernelにいれるのは
		min(自分のポリシ, ネゴ結果)
