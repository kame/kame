			CHANGELOG for KAME kit

$Id: CHANGELOG,v 1.618 2000/02/25 09:06:34 itojun Exp $

<200002>
Fri Feb 25 18:03:58 JST 2000  itojun@iijlab.net
	* kame/traceroute/ifaddrlist.c: ignore 0.0.0.0, it is meaningless
	  as source.  if you run ISC DHCP client and lease expires, the address
	  appears as interface address.

2000-02-25  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* bsdi4/sys/net/if.c (ifa_ifwithnet):
	* bsdi4/sys/net/route.c (ifa_ifwithroute):
	loosened restriction on p2p interfaces. It was too strict for
	KAME's IPv6 support.

2000-02-25  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* {(net|open)bsd, freebsd3}/sys/netinet/tcp_input.c:
	* kame/sys/netinet6/tcp6_input.c:
	prevented from storing 2292bis IPv6 options in a listening
	socket. Ancillary data on a listening socket was meaningless and
	even harmful for applications.

2000-02-25  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	RFC2292bis support:
	* bsdi4/sys/netinet/tcp_output.c (tcp_output): 	
	  passed IPv6 output options to ip6_ouput().
	* bsdi4/sys/netinet/tcp_input.c: 
	  passed specified IPv6 optional data to a user as ancillary data.
	* bsdi4/sys/netinet/in_pcb.c (in_pcbdetach):
	  fixed memory leak of received IPv6 options.

2000-02-25  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/libinet6/getnameinfo.c (ip6_sa2str, getnameinfo):
	  changes according to the recent discussion:
	  - always print scope_id of an IPv6 address with non-zero
	    sin6_scope_id (by default), even for a global unicast address.
	  - use numeric numbers as the last resort of a scope_id string.

Fri Feb 25 01:49:00 JST 2000  itojun@iijlab.net
	* */sys/net/rtsock.c: wrap BBN hack (honor ifp/ifa on RTM_ADD),
	  into #ifdef BBNHACK.  it conflicts with proxy NDP and mobile-ip6.
	  (see CHANGELOG entry on Tue Nov 17 14:57:51)

Fri Feb 25 01:34:11 JST 2000  itojun@iijlab.net
	* sys/netinet6/in6.c: net.inet6.icmp6.nd6_proxyall was obsoleted.
	  use "ndp -s <v6> <mac> proxy" if you need the same functionality.

Fri Feb 25 01:34:37 2000  SUMIKAWA Munechika  <sumikawa@ebina.hitachi.co.jp>
	* freebsd2/ports/openssh: make buildable.
	* freebsd3/ports/heimdal: upgrade to 0.2q.

2000-02-24  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* bsdi4/usr.sbin/{traceroute6, ping6}/Makefile: enabled IPsec
	related	definitions.

Thu Feb 24 18:59:14 JST 2000  itojun@iijlab.net
	* sys/netinet/ip_icmp.c (except openbsd):
	  don't transmit ICMPv4 packet back if the original packet was
	  encrypted.  if we send those, we may mistakingly leak secret
	  information.  From: jinmei

2000-02-24  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* bsdi4/usr.sbin/vmstat: was just imported. We don't have to
	modify the code, but it should be recompiled to support additional
	memory types used in the kernel.

2000-02-24  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/in6.c (in6_control): clarified address
	management ioctls:
	- invalidated SIOCSIFDSTADDR_IN6 and SIOCSIFNETMASK_IN6. They are
	  not very suitable in an IPv6 era, when we can assign multiple
	  addresses on a single interface.
	- added strict validations for address families of arguments.

2000-02-24  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* bsdi4/usr.sbin/netstat/{main.c, inet6.c(added)}: printed KAME's
	statistics for IPv6 and ICMPv6 instead of original ones.

Thu Feb 24 JST 2000  itojun@iijlab.net
	* libinet6/getifaddrs.c: bring in freeifaddrs().  this is in sync
	  with bsdi4 change.  From: dab@bsdi.com
	* bsdi4: enable kernel IPsec code by default.  it looks to be working
	  fine now, thanks to jinmei's efforts.

2000-02-24  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/ah_input.c (ah4_input): prevented
	re-translating the byte order of the ip_id field on bsdi4.

2000-02-24  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/netstat/ipsec.c: 
	* bsdi4/usr.sbin/netstat:
	modified to print KAME's IPsec statistics.
	
2000-02-24  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/traceroute/traceroute.c (send_probe): 
	* bsdi4/usr.sbin/traceroute/Makefile: 
	changed a bit to calculate a UDP checksum correclty on bsdi4.

Wed Feb 23 21:26:21 JST 2000 sakane@ydc.co.jp
	* kame/kame/racoon:
	  fixed to compute RSA signature.  SIGN was computed including OID.
	  Now, racoon gets a interoperability with isakmp-test.ssh.fi.
	  TODO: must be check the signer of certificate.

2000-02-23  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* (all OSes)/usr.sbin/{bgpd, pim6[ds]d}/Makefile: added the
	-DHAVE_GETIFADDRS compile option.
	Note: please be sure to update the whole tree, do "make prepare",
	update include files, and then rebuild the whole kit.

2000-02-23  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/pim6[ds]d/config.c (config_vifs_from_kernel): used
	getifaddrs().

2000-02-23  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.pco.jp>
	* kame/kame/bgpd/if.c (ifconfig): use getifaddrs (if available)
	instead of SIOCGIFCONF, since the former interface is more
	friendly and safer.

Wed Feb 23 JST 2000  itojun@iijlab.net
	* libinet6/getifaddrs.c: bring in getifaddrs(3) from BSDI4 (it is
	  under redistributable Berkeley license).  SIOCGIFCONF is very hard to
	  use correctly, due to (1) alignment constraints in 64bit arch
	  (2) try-and-error memory allocation since there's no way to estimate
	  required buffer size beforehand.  We hope to bring this function
	  into *BSD.

Tue Feb 22 14:56:59 2000  SUMIKAWA Munechika  <sumikawa@ebina.hitachi.co.jp>
	* freebsd2/ports/openssh: upgrade to 1.2.2 and mark as broken. we
	  need volunteers to make buildable this port.

Tue Feb 22 00:59:54 JST 2000  itojun@iijlab.net
	* sys/kern/uipc_mbuf{,2}.c, sys/sys/mbuf.h: allow mbuf attachment to
	  m->m_pkthdr.aux.  this would be useful to pass around extra
	  information across protocol handlers.  current consumers are
	  sys/netinet/ip_encap.c (extra data passing - mainly for struct ifnet)
	  and sys/netinet6/ipsec.c (socket policy passing).
	  careful about mbuf memory leak if you try using it...

	  NOTE: it is necessary to clear m_pkthdr on mbuf allocation.
	  there are drivers that does NOT use MGETHDR to allocate packet
	  header mbuf.  these drivers may need fixes.

2000-02-21  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* bsdi4/sys/(several files): added initialization for IPsec. Now
	the kernel can be built and run with the IPSEC option (though we
	may need some more work to stabilize it).

Mon Feb 21 20:48:13 JST 2000  itojun@iijlab.net
	* {freebsd[23],netbsd}/usr.sbin/racoon/Makefile.inc:
	  add library paths for "USA resident" case (link separate librsaref).

Mon Feb 21 15:53:56 JST 2000  itojun@iijlab.net
	* netbsd/pkgsrc/www/apache: upgrade to 1.3.11 with IPv6 patch.

2000-02-21  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* bsdi4/sys/net/zlib.[ch]: were (blindly) copied from
	bsdi3/sys/net/. The kernel will be able to be built with the IPSEC
	option with these files, but we've not fully tested the KAME IPsec
	stuff on bsdi4. Please do not try it for now.

2000-02-21  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* bsdi4/sys/conf/files: removed ptr_xxx functions, which have been
	obsoleted.

Mon Feb 21 13:42:28 2000  SUMIKAWA Munechika  <sumikawa@ebina.hitachi.co.jp>
	* {freebsd3/ports,netbsd/pkgsrc/security}/heimdal: upgrade to 0.2p.

2000-02-21  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/bgpd: tons of changes and improvements including:
	+ static routes support
	+ input/output filter for BGP4+ routes
	+ configurable description about RIPng interfaces and BGP4+ peers
	+ exportation of interface direct routes to IBGP peers
	+ configurable logging level
	+ collecting much more statistics
	+ new configuration parser using lex and yacc
	(TODO: revise bgpd.conf.5 accordingly)

Sun Feb 20 23:45:24 2000  SUMIKAWA Munechika  <sumikawa@ebina.hitachi.co.jp>
	* freebsd[23]/ports/{tcpdump,libpcap}: upgrade to 2/14 weekly snapshot.
	* freebsd[23]/ports/apache13: upgrade to latest IPv6 patch.

Sat Feb 19 22:12:10 JST 2000  itojun@iijlab.net
	* sys/netinet6: sync with latest ericsson mobile-ip6.
	* sys/netinet/ip_encap.[ch]: struct encaptab is now visible to
	  outside, read-only, on encap_attach().

2000-02-19  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* bsdi4/sbin/ifconfig/ifconfig.c: enabled KAME original functions.

2000-02-19  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* bsdi4/sys/netinet/in.c (in_control): added gif related ioctls.

Sat Feb 19 11:40:58 2000  Shin'ichi Fujisawa  <fujisawa@kame.net>
	* sys/netinet6/natpt*: Now, this translator can handle connection from
	  outside v4 (global) to inside v6 (private).  This translation is
	  done when packet is coming toward particular address and port, so
	  you must know this particular port number before making connection.

	- kernel:
		many changes in netinet6/natpt_*.[ch]
		add in4_len2mask() in netinet/in.c to call in_len2mask().

	- userland:
		slightly changed natptconfig command syntax.
		can log ipv4, ipv6 and mbuf.

Sat Feb 19 02:52:09 JST 2000  itojun@iijlab.net
	* {openbsd,netbsd,bsdi4}/sys/sys/socket.h: fix 64bit alignment issue
	  in 64bit architecture.
	  From: =?iso-8859-1?Q?G=F6ran_Bengtson?= <goeran@cdg.chalmers.se>

Fri Feb 18 20:09:35 JST 2000  itojun@iijlab.net
	* netbsd/pkgsrc/audio/mpg123: upgrade to latest IPv6 patch.
	* netbsd/pkgsrc/net/{tcpdump,libpcap}: upgrade to 2/14 weekly snapshot.

Fri Feb 18 02:31:47 2000  SUMIKAWA Munechika  <sumikawa@ebina.hitachi.co.jp>
	* freebsd[23]/ports/apache13: upgrade to 1.3.11.

Thu Feb 17 22:30:13 JST 2000 sakane@ydc.co.jp
	* kame/kame/racoon:
	- support RSA signature authentication method on main/aggressive/base
	  mode.  There is a tips in racoon/doc/README.certificate.
	  Local test is done.  But between isakmp-test.ssh.fi and racoon,
	  to verify signature is failed.
	  TODO: to be check issuer of signature.

Thu Feb 17 16:52:56 2000  SUMIKAWA Munechika  <sumikawa@ebina.hitachi.co.jp>
	* {freebsd[23]/ports, netbsd/pkgsrc/net}/rsync: upgrade to 2.4.1.

Thu Feb 17 15:15:02 JST 2000  itojun@iijlab.net
	* sys/net/if_gif.c: fix bogus gifconfig failure, on multiple gif
	  configuration.
	  From: Takahiro Yugawa <yugawa@itjit.ad.jp>

Thu Feb 17 14:36:07 JST 2000  itojun@iijlab.net
	* sys/netinet6/nd6.c: better support for proxy NDP (per ND entry,
	  just like arp -s).  routing entry marked with RTF_ANNONUCE
	  (= RTF_PROTO2) will get announced by proxy ND.  on ND table, proxy
	  NDP entry will stay as permanent/reachable entry.
	  
	  To use this stuff, you need to backout bbn changes in rtsock.c.
	  otherwise ndp -s will not work and you can not set proxy ND entry.
	  (bbn rt_setif() overwrites sockaddr_dl in gateway portion)

	  TODO:
	  - proxy NA delay on output (RFC2461 7.2.8)
	  - anycast NA delay on output (RFC2461 7.2.7)
	* */usr.sbin/ndp: proxy ND support (ndp -s has "proxy" keyword added).

	  TODO: proxy ND for global address X, where X is outside of prefixes
	  assigned to the interface we would do proxy ND.  currently we try to
	  grab link-layer information from RTM_GET.  so if X is outside of
	  configured prefixes, we can't configure X for proxy NDing, or static
	  ND entry.  we may need to explicitly pass "interface" information
	  to ndp -s.

Thu Feb 17 00:40:39 JST 2000  itojun@iijlab.net
	* sys/net/if_gif.c: fix IFF_LINK0 (multi destination mode), which
	  was broken during ip_encap.c migration.

Wed Feb 16 23:57:53 2000  SUMIKAWA Munechika  <sumikawa@ebina.hitachi.co.jp>
	* freebsd[23]/lib/libftpio: add '229 Entering Extended Passive
	  Mode' from RFC2426
	* freebsd2/ports/mpg123: upgrade to latest IPv6 patch and sync
	  with FreeBSD-current.

Wed Feb 16 22:45:13 JST 2000 sakane@ydc.co.jp
	* kame/kame/racoon:
	  stop racoon to start when it's failed to open addresses specified
	  in racoon.conf.

Wed Feb 16 12:17:05 JST 2000  itojun@iijlab.net
	* libinet6/getaddrinfo.c: add experimental support for post-RFC2553
	  getaddrinfo(AI_ADDRCONFIG).  the semantics of AI_ADDRCONFIG is
	  still very vague so do not expect stable behavior.

2000-02-15  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* {bsdi4, openbsd}/sys/netinet6/raw_ipv6.c (rip6_ctloutput):
	prohibited the ICMP6_FILTER socket option unless the level is
	IPPROTO_ICMPV6.

2000-02-15  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* bsdi4/sys/netinet6/raw_ipv6.c (rip6_input): re-enabled filter
	for incoming ICMPv6 packets.

Tue Feb 15 00:42:32 2000  SUMIKAWA Munechika  <sumikawa@ebina.hitachi.co.jp>
	* freebsd3/ports/pident6d: upgrade to latest IPv6 patch and sync
	  with FreeBSD-current.

Mon Feb 14 22:36:47 JST 2000  itojun@iijlab.net
	* netbsd/pkgsrc/mail/fetchmail: upgrade to 5.2.7.
	* freebsd[23]/sys/net: remove "options TAHI".  installed new patch
	  to support TAHI test suite (lets userland program to specify
	  ethernet hardware address).

Sun Feb 13 04:26:17 JST 2000  itojun@iijlab.net
	* libinet6/get{addr,name}info.c: based on most recent discussion,
	  flip the order for extended scoped address notation again
	  (now fe80::1%de0).

Sat Feb 12 16:49:15 JST 2000  itojun@iijlab.net
	* netbsd/pkgsrc/net/ethereal: upgrade to 0.8.3.

Fri Feb 11 15:06:19 JST 2000  itojun@iijlab.net
	* netbsd/sys/netinet/ip_input.c: fix infinite packet forwarding loop
	  for packet toward address on !IFF_UP interface.
	  NetBSD PR9387 from nrt@iij.ad.jp.

Fri Feb 11 02:42:16 JST 2000  itojun@iijlab.net
	* sys/netinet/ip_encap.c: revisit input logic for tunnelled packets.
	  move outer address match logic from in{,6}_gif_input() to
	  encap[46]_input(), so that other guys (like mobile-ip6, 6to4,
	  6over4, whatever) can match packets based on not only by proto #,
	  but also by src/dst with masks.
	  see comment on ip_encap.c for detail - I hate tunnelling.  really.
	  TODO: we do not really support subnet match for input logic.  it
		needs careful ordering of packet matching table in encap[46],
		so that we can check for better match earlier.
		(since we have mask parameter for both src and dst, it is
		not trivial to define total order among entries)
	  TODO: change ipip_input() to conform to this framework?
	  CAVEAT: IFF_LINK0 for gif is not working with this change, i'll try
		to clean it up.
	* allow raw ip{,6} output for proto #4 and #41.

Fri Feb 11 01:48:16 JST 2000  itojun@iijlab.net
	* sys/netinet6/raw_ip6.c: implement rip6_ctlinput(), so that we can
	  notify of route changes to raw ip6 layer (not ready for
	  freebsd3/openbsd at this moment).
	* sys/net/if_gif.c: properly check outer address family during
	  initialization.

Thu Feb 10 22:56:51 JST 2000  itojun@iijlab.net
	* bsdi[34]/sys/i386/isa/if_cce.c: fix mbuf allocation on inbound packet.
	  From: SUZUKI Shinsuke <suz@sdl.hitachi.co.jp>
	* bsdi3/sbin/ifconfig/ifconfig.c: fix error trap on bogus IPv6 hostname.
	  From: SUZUKI Shinsuke <suz@sdl.hitachi.co.jp>

Thu Feb 10 13:45:53 JST 2000  itojun@iijlab.net
	* netbsd/pkgsrc/security/openssl: add openssl pkgsrc for 0.9.4
	  (only because netbsd 1.4.1 did not include it).

2000-02-09  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/icmp6.c (icmp6_reflect): do not use a
	duplicated address as source of reflected packets.

2000-02-09  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/in6.c (in6ifa_ifpforlinklocal): an additional
	argument was added in order to specify ignoring some kind of
	addresses (e.g. duplicated or anycast).
	Several callers of this function were also modified so that they'd
	not send packets with invalid link-local sources.

Wed Feb  9 14:20:08 JST 2000 sakane@ydc.co.jp
	* kame/kame/racoon:
	- try to support certificate ISAKMP_CERT_X509SIGN.  But not tested.
	  There is a problem that OpenSSL0.9.4 can not read a certificate which
	  is issued by CA1 at isakmp-test.ssh.fi.
	  TODO: to be check signature of CA.
	- move a part of functions of certificate into crypto_openssl.c.
	  signing.c will be merged into crypto_openssl.c.

Wed Feb  9 04:28:50 2000  SUMIKAWA Munechika  <sumikawa@ebina.hitachi.co.jp>
	* freebsd3/ports/openssh: upgrade to 1.2.2
	* freebsd3/ports/apache12: remove this port since it's too old.
	* freebsd3/sys/netinet/tcp_output.c: get mbuf cluster if the size
	  of IP header and TCP header are over MHLEN. This fix avoid to
	  panic when some tcp options are used.
	    PR: fbsd3/191
	    From: bmah@ca.sandia.gov

Wed Feb  9 01:09:21 JST 2000  itojun@iijlab.net
	* netbsd/pkgsrc/net/gated-ipv6, freebsd[23]/ports/net/gated-ipv6:
	  upgrade base version to gated-ipv6, 2000/2/3.

2000-02-09  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/in6.c: removed in6_canforward() according to
	the recent clarification in ip6_forward().

2000-02-09  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/ip6_forward.c (ip6_forward): if a forwarded
	packet is going to break a scope boundary, return an icmp6
	destination unreachable (beyond scope) error.

Tue Feb  8 23:13:32 JST 2000 sakane@kame.net
	* kame/racoon:
	  man page updated against recent modification.

Tue Feb  8 20:54:13 2000  SUMIKAWA Munechika  <sumikawa@ebina.hitachi.co.jp>
	* freebsd3/ports/bind9: bind9 beta.
	* freebsd3/ports/ssh: fix freeaddrinfo(NULL) bug, which cause by
	  mis-patched FreeBSD specific patch(patches/patch-al)

Tue Feb  8 03:00:45 JST 2000  itojun@iijlab.net
	* sys/netinet6/mip6*: mobile-ip6 code from Ericsson.  currently
	  build tree is made available for netbsd and freebsd2.
	  for other platforms, build tree will be populated soon.
	  not really tested by KAME team yet.
	* kame/rtadvd: modified for mobile-ip6 support.
	* kame/mip6config, kame/mip6stat: mobile-ip6 controllers.

Mon Feb  7 21:32:13 JST 2000  itojun@iijlab.net
	* sys/netinet6/{ip6,icmp6,in6.h}, sys/netinet/{ip6,icmp6,in.h}:
	  to promote RFC2553/2292 conforming applications, we now disallow
	  direct inclusion of the following files:
		netinet6/ip6.h
		netinet6/icmp6.h
		netinet6/in6.h
	  users need to include the following items instead:
		netinet/ip6.h
		netinet/icmp6.h
		netinet/in.h (pulls in both IPv4 and IPv6 decls)
	* sys/netkey/keyv2.h, sys/net/pfkeyv2.h:
	  similarly, to promote RFC2367 conforming applications, inclusion of
	  netkey/keyv2.h is now disallowed.  include net/pfkeyv2.h instead.
	  (based on discussion in kame team)

Mon Feb  7 03:03:42 JST 2000  itojun@iijlab.net
	* sys/net/rtsock.c (except bsdi[34])
	  avoid panic on RTM_IFINFO, due to decreased MHLEN.
	  From: Conny Larsson <conny@verkstad.net>

Sun Feb  6 17:56:47 JST 2000  itojun@iijlab.net
	* netbsd/sys/netinet/tcp_output.c: optimize mbuf allocation on output.
	  allocate cluster only when necessary.

2000-02-06  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/bgpd/bgp_input.c (bgp_read): 
	* kame/kame/bgpd/main.c (main_listen_accept):
	Prevented blocking on a socket for a BGP4+ connection caused by
	ancillary data.
	Note: this fix needs the latest kernel. Older kernel might panic
	with the latest bgpd.

Sun Feb  6 00:27:25 JST 2000  itojun@iijlab.net
	* sys/netinet6/esp_input.c: remove too-strong assumption about mbuf
	  alignment.

Sat Feb  5 16:40:20 JST 2000  itojun@iijlab.net
	* sys/netinet6/nd6.c, kame/ndp: give more information about
	  prefix on ndp -p.  the kernel manages two separate prefix
	  table: one for RAs a host listened, and another is for RAs
	  a router will advertise (the latter will be modified by
	  router renumbering).

Sat Feb  5 14:09:07 JST 2000  itojun@iijlab.net
	* netbsd/pkgsrc/net/bind9: pkgsrc for bind9 beta.
	* netbsd/pkgsrc/devel/unproven-pthreads: pthread package required
	  for bind9.

2000-02-05  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/libinet6/getaddrinfo.c (explore_numeric_scope): 
	* kame/kame/libinet6/getnameinfo.c (getnameinfo):
	Revised the format for scoped addresses by agreement with MSR.
	Two big changes are included:
	- The scope ID portion is now placed before the address
	- The delimiter character is changed to '%'
	So for example, we can specify a link-local address on the
	interface ne0 like ne0%fe80::1234
	The scopedaddr-format draft will soon be revised as well according
	to this change.

Fri Feb  4 23:36:26 JST 2000  itojun@iijlab.net
	* sys/netinet6/in6_ifattach.c: improve in6_ifdetach() for cleaning
	  up structures that depend on struct ifnet/ifaddr.  should be
	  made more elegant...

Fri Feb  4 02:09:41 JST 2000  itojun@iijlab.net
	* sys/netinet6/frag6.c: be LP64 environment friendly.  do not reuse
	  ip6 header portion on reassembly.
	  notified by NetBSD PR 9340 from iwamoto@sat.t.u-tokyo.ac.jp.

Fri Feb  4 01:20:15 JST 2000  itojun@iijlab.net
	* netbsd/sys/dev/ic/smc91cxx.c: fix promisc mode for sm* interface.

2000-02-03  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* (for all OSes)/netstat/inet6.c (ip6_stats): print statistics
	  about source address selection.

2000-02-03  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/in6.c (in6_ifawithscope): revised source
	address selection algorithm. In short, the new algorithm is as
	follows:
	- search for an address that has enough scope for a given
	  destination.
	- if more than one address has enough scope, choose one that
	  matches longest against the destination address.
	- if there is no other reasons to choose one, an address on the
	  outgoing I/F are preferred.
	TODO: update the IMPLEMENTATION file as well.

Thu Feb  3 20:23:06 JST 2000  itojun@iijlab.net
	* sys/netinet6/{icmp6,nd6*}.c: implement m_pulldown cases for
	  ND and redirect.
	* sys/kern/uipc_mbuf2.c: add more m_pulldown statistics to compare
	  its efficiency against m_pullup{,2}.

2000-02-03  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/pim6[ds]d/mld6.c (make_mld6_msg): corrected HBH header
	length in the 2292bis case.
	In response to: kit/198 from ryuji-so@is.aist-nara.ac.jp

Thu Feb  3 02:22:03 JST 2000  itojun@iijlab.net
	* sys/netinet6/in6.c: improve multicast kludge list management.
	  clear dangling pointer, update ifnet refcnt correctly.

Wed Feb  2 22:53:03 JST 2000  itojun@iijlab.net
	* sys/netinet6/in6_ifattach.c: improve in6_ifdetach().  remove
	  static route to linklocal allnode multicast (ff02:x::/32).
	  remove multicast kludge entries as well, if exists.

Wed Feb  2 16:16:01 JST 2000  itojun@iijlab.net
	* bsdi4/sys: fix ifindex manipulation to be compatible with KAME.
	  from kato@wide.ad.jp.  (in NAT, ppp and ATM code)

Wed Feb  2 15:39:40 JST 2000  kjc@csl.sony.co.jp
	* add a new traffic conditioner type, tswtcm (time sliding
	  window three color marker) to altq.  it is described
	  in draft-fang-diffserv-tc-tswtcm-00.txt.

Wed Feb  2 12:55:44 JST 2000  itojun@iijlab.net
	* kame/rtadvd: router renumbering input needs to be explicitly
	  enabled with command line option (-R).  this is for security issue
	  in router renumbering protocol - it requires use of IPv6 IPsec
	  over site-local multicast.  (IPsec issue should be improved)

Tue Feb  1 12:45:02 JST 2000  itojun@iijlab.net
	* {netbsd/pkgsrc/games/quake6, freebsd[23]/ports/quake6}:
	  quake over IPv6.

Tue Feb  1 01:52:20 2000  SUMIKAWA Munechika  <sumikawa@ebina.hitachi.co.jp>
	* freebsd3/ports/echoping: echoping 2.2.0 with IPv6 support.
	* freebsd3/ports/lynx: upgrade 2.8.2rel1 with current IPv6 patch.

Tue Feb  1 01:11:34 JST 2000  itojun@iijlab.net
	* {netbsd/pkgsrc/mail,freebsd3/ports}/soldpop3d: pop3 daemon from
	  poland.
	* kame/racoon: simplify the configure process.  allow it to be compiled
	  on openssl-integrated platform (netbsd15), even without rsa headers/
	  libraries (cert support will automatically be disabled).

<200001>
Mon Jan 31 16:25:42 JST 2000  itojun@iijlab.net
	* non-openbsd: don't reuse m->m_pkthdr.rcvif for passing extra
	  inforation necessary for ipsec.  use ipsec_[sg]etsocket() and
	  m->m_pkthdr.aux.
	* kame/sys/crypto/sha1.[ch]: const poisoning.
	  
Mon Jan 31 00:42:47 JST 2000  itojun@iijlab.net
	* netbsd/pkgsrc/mail/{sendmail,smtpfeed}: upgrade smtpfeed to 1.04.
	  synchronize with latest NetBSD pkgsrc.

Sun Jan 30 15:30:14 JST 2000  itojun@iijlab.net
	* kame/libinet6/rcmd.c: fix behavior on non-IPv6 node.  From shin.
	* kame/libinet6/getaddrinfo: fix AI_ADDRCONFIG concern when
	  getipnodebyname() is used as backend.
	* netbsd/pkgsrc/net/echoping: echoping 2.2.0 with IPv6 support.

Sat Jan 29 16:20:31 JST 2000  itojun@iijlab.net
	* kame/sys/netinet6/ipsec.c (and other ipsec items):
	  cleanup include file dependencies and namespace polution, like
	  prototypes and #define KERNEL.
	* kame/sys/netinet6/ip6_input.c: fix ip6_savecontrol() to be friendly
	  with m_pulldown() environment.  now it does not modify mbuf chain
	  at all.  therefore, calling ip6_savecontrol() will not invalidate
	  pointers into mbuf chain (like "uh" in udp6_input).

Fri Jan 28 15:37:46 JST 2000  itojun@iijlab.net
	* kame/sys/netinet6/ipsec.c, kame/sys/netkey/key.c,
	  */sys/netinet{,6}/ip{,6}_input.c: pass policy message buffer length
	  down.  this is to avoid key_msg2sp() from making buffer overrun
	  on invalid input from the userland.

2000-01-28  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/tcp6_usrreq.c (tcp6_usrreq):
	* {bsdi4,netbsd,openbsd}/sys/netinet/tcp_usrreq.c (tcp_usrreq):
	* freebsd3/sys/netinet/tcp_usrreq.c (tcp_usr_rcvd):
	Do not call tcp[6]_output by the PRU_RCVD request unless the
	associated socket is connected. This fix will prevent kernel panic
	when a user receives an ancillary data object on a listening
	socket.

2000-01-28  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/advapitest: was added mainly for debugging. The tools
	would also be useful as references for developing an "advanced"
	IPv6 application using the advanced API (RFC2292 or 2292bis).

2000-01-28  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/in6_pcb.h (and many related places):
	  changed the type of the in6p_inputopts member of the in[6]pcb
	  structure to a pointer type in order to avoid compilation and
	  binary compatibility issues.
	  I believe this fix solves all the recent problem reports due to
	  the member.
	  It is recommended to recompile both the kernel and all the
	  userland applications with this fix.

Thu Jan 27 15:04:12 JST 2000  itojun@iiljab.net
	* netbsd/pkgsrc/net/rsync, freebsd[23]/ports/rsync: upgrade to
	  2.3.2 with latest IPv6 patch.

Thu Jan 27 06:20:08 2000  SUMIKAWA Munechika  <sumikawa@ebina.hitachi.co.jp>
	* freebsd[23]/ports/irc: upgrade to 2.10.3.

Thu Jan 27 00:29:51 JST 2000  itojun@iijlab.net
	* kame/sys/netinet6/in6_pcb.c: make IPV6_PORTRANGE actually work.
	  (netbsd/bsdi3/freebsd2)

Wed Jan 26 23:00:30 2000  SUMIKAWA Munechika  <sumikawa@ebina.hitachi.co.jp>
	* freebsd[23]/ports/pchar, netbsd/pkgsrc/net/pchar,
	  openbsd/ports/net/pchar: upgrade to 1.1.1.

Wed Jan 26 14:16:00 JST 2000  itojun@iijlab.net
	* kame/libinet6/getaddrinfo.c: from the specification, AI_CANONNAME
	  does not imply reverse query.  ai_canonname has the same meaning as
	  h_name (in struct hostent), nothing more.

Wed Jan 26 12:04:42 JST 2000  itojun@iijlab.net
	* kame/libinet6/bindresvport.c: remove bindresvport_af(), implement
	  bindresvport_sa().

Wed Jan 26 06:12:38 2000  SUMIKAWA Munechika  <sumikawa@ebina.hitachi.co.jp>
	* freebsd3/ports/irssi: upgrade to 0.7.23.

Wed Jan 26 03:33:41 JST 2000  itojun@iijlab.net
	* {netbsd/pkgsrc/net,freebsd[23]/ports}/{libpcap,tcpdump}:
	  famous packet capturing tool, from tcpdump.org codebase.  it
	  contains identical code as kame/{libpcap,tcpdump} so we plan
	  to avoid duplicate maintenance (put all libpcap/tcpdump
	  efforts into tcpdump.org).

Tue Jan 25 20:30:32 JST 2000  itojun@iijlab.net
	* kame/sys/netinet6/ipcomp_core.c: don't attach Adler32 checksum
	  to compressed data.  see ipsec wg mailing list (Jan 2000) for
	  details.

Tue Jan 25 17:21:15 JST 2000  itojun@iijlab.net
	* kame/libinet6/rcmd.c: make rcmd() behavior to IPv4-only, for safety
	  (see 2292bis for reasons).  implement rcmd_af().
	  KAME-supplied rlogin(1) and rsh(1) may not work right due to the
	  change.

Mon Jan 24 23:37:38 JST 2000  itojun@iijlab.net
	* netbsd/pkgsrc/net/ethereal: upgrade to 0.8.1.

Mon Jan 24 17:28:25 JST 2000  itojun@iijlab.net
	* netbsd/pkgsrc/net/fetchmail: upgrade to 5.2.4.

Mon Jan 24 12:49:34 2000  SUMIKAWA Munechika  <sumikawa@ebina.hitachi.co.jp>
	* freebsd3/ports/irssi: new port: irssi-0.7.22, GTK based irc
	  client.

Sun Jan 23 13:24:00 JST 2000  itojun@iijlab.net
	* kame/libinet6/getaddrinfo.c: remove #ifdef FAITH (and use of
	  environment varaible GAI).  this has been broken for a long time
	  (means noone is using it), and this shouldn't be here.
	  if you would like to set FAITH'ed prefix, use totd or /etc/hosts.

2000-01-22  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/ip6_input.c (ip6_reset_rcvopt): fixed a bug
	that a freed pointer could not be re-initialized, which might
	cause kernel panic.

Sat Jan 22 02:01:57 2000  SUMIKAWA Munechika  <sumikawa@ebina.hitachi.co.jp>
	* freebsd3/ports/lftp: new port: lftp-2.1.6, ftp client.

Fri Jan 21 21:17:35 JST 2000  itojun@iijlab.net
	* netbsd/pkgsrc/net/irc: upgrade to 2.10.3, make it buildable again.

Fri Jan 21 12:59:51 JST 2000  itojun@iijlab.net
	* netbsd/pkgsrc/net/totd, openbsd/ports/net/totd,
	  freebsd[23]/ports/totd: upgrade to 1.1p2.
	  From: Feico Dillema

Thu Jan 20 18:41:40 JST 2000  itojun@iijlab.net
	* netbsd/pkgsrc/lang/python, freebsd[23]/ports/python:
	  upgrade to latest IPv6 patch.

Wed Jan 19 22:04:22 2000 kjc@csl.sony.co.jp
	remove ECN support from TCP in freebsd3.
	it was removed in altq-2.0 and provided as a separate patch.

Wed Jan 19 21:47:19 2000 kjc@csl.sony.co.jp
	add atm pvc support tools included in the altq release.
	- pvcsif:    create pvc sub-interface
	- pvctxctl:  set vpi:vci and shaper
	- pvcbridge: set pvc bridge mode

Wed Jan 19 20:35:42 2000  Shin'ichi Fujisawa  <fujisawa@kame.net>
	* NAT-PT translator and its command become compilable on
	  freebsd2, freebsd3, netbsd, and bsdos3.

Wed Jan 19 06:44:02 JST 2000 sakane@ydc.co.jp
	* kame/kame/racoon:
	  improved the way to define a certificate type.
	  If signature method as `authentication method' is defined,
	  `identifier' is defined subjectname.
	  `certificate_type' is defined certificate type.
	  XXX why isn't certificate type negotiated in IKE ?

Wed Jan 19 05:15:50 JST 2000 sakane@ydc.co.jp
	* kame/kame/racoon:
	ignore certificate request, not error.  Should be handled.

Wed Jan 19 02:39:23 JST 2000  itojun@iijlab.net
	* netbsd/usr.sbin/lpd: IPv6 and multiple listening socket support.
	  NetBSD PR 9050 from Feico Dillema.

Wed Jan 19 00:15:50 JST 2000  itojun@iijlab.net
	* kame/libinet6/bindresvport.c: bring in bindresvport_af() from
	  openbsd-current.  the function signature and behavior is under
	  debate in ipngwg mailing list, so I thought it would be good to
	  bring it in and try using it, to see any pros/cons we might have
	  in particular proposal (and other proposals).
	  (available in netbsd, openbsd, freebsd2 and freebsd3)

Tue Jan 18 22:48:35 JST 2000  itojun@iijlab.net
	* kame/libinet6/rresvport_af.c: preserve old rresvport() behavior.
	  it needs to honor parameter (*port) if given.  previous behavior
	  was broken.
	  From: Markus Friedl <Markus.Friedl@informatik.uni-erlangen.de>

Tue Jan 18 16:30:05 JST 2000 kjc@csl.sony.co.jp
	update ALTQ from 2.0 to 2.1.
	this version supports openbsd in addition to freebsd2, freebsd3
	and netbsd.
	kernel:
	- altq related files are moved from "sys/net" and "sys/netinet"
	  to "sys/altq" not to bloat the standard directories.
	- rename the altq kernel config file from ALTQ to ALTQ.v4 since
	  it's only for IPv4 and GENERIC.v6 has ALTQ already defined.
	  for openbsd/netbsd, on non-i386 architecture: read IMPLEMENTATION
	  section 5 for installation details.
	userland:
	- the following altq tools are added to the tree:
	  lib/altqlib, usr.sbin/altqd, user.bin/altqstat.
	- install MAKEDEV.altq to /dev.

	NOTE: be sure to cleanup old symlinks, by "make TARGET=netbsd clean",
	in the top directory.

2000-01-18  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/icmp6.h: changed the type of the
	icmp6_n[il]_nonece member of the icmp6_{namelookup, nodeinfo}
	structures from u_int64_t to u_int8_t[8] in order to avoid
	possible alignment problems.
	From: Ryota HIROSE <hirose@comm.yamaha.co.jp>

Tue Jan 18 13:57:28 JST 2000  itojun@iijlab.net
	* freebsd3/sys/netinet6/udp6_usrreq.c: fix panic on udp6_ctlinput.
	  from: ume@mahoroba.org
	* kame/rtadvd: obey RFC2461 6.2.5 when rtadvd dies with SIGTERM.
	  read manpage for more details.

Tue Jan 18 12:36:24 2000  SUMIKAWA Munechika  <sumikawa@ebina.hitachi.co.jp>
	* freebsd3: good bye __ss_{len,family}, hello ss_{len,family}.

Tue Jan 18 01:43:10 JST 2000  itojun@iijlab.net
	* openbsd/usr.bin/fstat: make it IPv6 ready.  based on NetBSD PR 9199
	  by Hiroshi Ura.

Tue Jan 18 00:46:09 JST 2000  itojun@iijlab.net
	* kame/libinet6/getaddrinfo.c: don't filter out AFs that are not
	  supported by the kernel, when we do address resolution of FQDN.
	  the previous behavior was broken.

Mon Jan 17 13:47:13 JST 2000  itojun@iijlab.net
	* netbsd/pkgsrc/net/zebra, freebsd3/ports/zebra,
	  openbsd/ports/net/zebra: upgrade to 0.84a.

Mon Jan 17 2000  sakane@kame.net, itojun@kame.net
	* racoon: tons of improvements into our IKE daemon.
	  - SA bundle is now handled correctly (both phase 1/2)
	  - will not SEGV even if last packet in phase 1/2 get resent
	  - KEYMAT generation will take care of long keys correctly
	  - phase 1/2 userfqdn support (ashley-laurent hack)
	  - don't attach DH group type for well-known groups
	  - key length handling is fixed
	  - phase 1 base mode
	  - byte lifetime bug fix (but introduced new bug so still buggy)
	  - parser fixes (issue with DH group setting)
	  - fix variable-length spi support (don't hardcode it to 32bit)
	  - ipcomp negotiation fix
	* kernel ipsec: fix SA reference counting.  now dangling SAs will be
	  cleaned up correctly. (removes incorrect fix on Jan 8 2000)

Mon Jan 17 03:36:44 2000  SUMIKAWA Munechika  <sumikawa@ebina.hitachi.co.jp>
	* freebsd3/sys/netkey/keysock.c: this file was removed. Now
	  freebsd3 uses shared one, kame/sys/netkey/keysock.c

	  NOTICE: If you use freebsd3 via cvsup/anoncvs, you must clean
	  your source tree and relink shared sources.
	  % cd kame; make TARGET=freebsd3 clean prepare

Mon Jan 17 02:25:54 JST 2000  itojun@iijlab.net
	* {netbsd,bsdi3,freebsd2}/netstat: try to share souce code across OS
	  platforms as much as possible.  we are able to share ipsec.c without
	  too much troubles.  will try to do it for other platforms, and other
	  portions (like inet6.c).

Sun Jan 16 23:30:16 JST 2000  itojun@iijlab.net
	* kame/sys/net{inet6,key}: cleanup ipsec logging.  all logs will be
	  generated to syslog, with proper priority (for example, sequence
	  number cycle will be logged with LOG_WARNING).  you can
	  suppress/enable logs by setting net.inet.ipsec.debug (or
	  net.inet6.ipsec6.debug).   even if you supress logs, you can check
	  "netstat -sn" to understand what was happend to ipsec stack.

Sun Jan 16 21:49:38 JST 2000  itojun@iijlab.net
	* netbsd/usr.bin/fstat: make it IPv6 ready.
	  NetBSD PR: 9199
	  From: ura@hiru.aoba.yokohama.jp

Sat Jan 15 03:56:50 JST 2000  itojun@iijlab.net
	* kame/sys/netinet6/ipcomp_core.c: change default deflate window size
	  for inbound to default (2^15).  without this change we can't
	  interoperate with some of IPcomp implementations.
	  see changelog entry on Nov 5 1999.

2000-01-14  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/ip6_output.c (ip6_copypktopts): was added in
	order to copy the in6p_outputopts member from a listening PCB to a
	corresponding accepting one. TCP input routines are also modified
	to call the function.

2000-01-14  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/ip6_input.c (ip6_savecontrol): was modified in
	order to conform to Section 4.1 of rfc2292bis-01; TCP
	implementation now passes incoming packet infomration to a user
	(as ancillary data) only when some changes of the content exist.
	Note that this change introduced various related changes of
	transport layers on all the platforms. Please be careful updating.

Fri Jan 14 13:55:19 2000  SUMIKAWA Munechika  <sumikawa@ebina.hitachi.co.jp>
	* freebsd3/ports/fetchmail: Upgrade to 5.2.3 and sync with
	  FreeBSD-current.

Fri Jan 14 12:15:27 JST 2000  itojun@iijlab.net
	* kame/libinet6/rcmd.c: avoid passing dangling pointer to **ahost.
	  we copy the value (ai_canonname, or hp->h_name) to static buffer
	  to keep semantics of rcmd() - requires no free() to the caller.
	  From: Hideaki YOSHIFUJI <yoshfuji@ecei.tohoku.ac.jp>

Fri Jan 14 02:16:16 JST 2000  itojun@itojun.org
	* kame/libpcap/inet.c: improve warning message when libpcap fails to
	  get IPv4 address on the interface it runs on.

Wed Jan 12 17:21:40 2000  SUMIKAWA Munechika  <sumikawa@ebina.hitachi.co.jp>
	* freebsd3/ports/ruby: Upgrade to 1.4.3 and sync with
	  FreeBSD-cuurent. No extra IPv6 patch is necessary anymore.

Wed Jan 12 15:40:05 JST 2000  itojun@iijlab.net
	* {bsdi3,netbsd,freebsd2}/usr.sbin/inetd: allow multiple IPsec policy
	  string specifier (separated by semicolon).  to be integrated into
	  other operating systems as well.

Wed Jan 12 05:13:33 2000  SUMIKAWA Munechika  <sumikawa@ebina.hitachi.co.jp>
	* freebsd3/ports/mrt, netbsd/pkgsrc/net/mrt: Upgrade to 2.1.2a.

2000-01-10  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/ip6_output.c (ip6_pcbopt): made the
	IPV6_NEXTHOP socket option removal by specifying the option
	with 0 length according to the following mail:
	Message-ID: <Roam.SIMC.2.0.6.947118462.12265.nordmark@jurassic>
	From: Erik Nordmark <Erik.Nordmark@eng.sun.com>
	Date: Wed, 5 Jan 2000 16:27:42 -0800 (PST)

2000-01-10  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* freebsd[23]/sbin/route/route.c (getaddr): corrected a bug in
	examining interface flags for the RTA_GATEWAY case in getaddr();
	use a separate variable and ioctl in order to get correct flags.
	Note that this fix may introduce a stricter check for arguments of
	the `-interface' modifiers; now you can specify point-to-pointer
	interfaces only, which was the intention of the code.

2000-01-10  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* bsdi3/sbin/route/route.c (getaddr): reverted the change for the
	"-interface XXX" modifier. We can use the -ifp modifier to
	accomplish the motivation.

2000-01-10  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/{in6.h, ip6_output}: disabled the following
	socket options, that were just derived from IPv4 and were not
	standards any more;
	IPV6_OPTIONS, IPV6_RECVOPTS, IPV6_RECVRETOPTS, IPV6_RECVDSTADDR,
	and IPV6_RETOPTS.

2000-01-10  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/net/if_gif.c (gif_output): changed the (default) upper
	limit of how many times gif_output can be called.
	Now no nesting is allowed by default, since some systems do not
	allow so many recursive calls in kernel.

Sun Jan  9 10:32:59 JST 2000  sakane@kame.net
	massive clarification to racoon ISAKMP daemon.
	- Merged Eric Lemiere's code for limited certificate support.
	- There are two management hander.
		"Phase 1 handler" is to manage ISAKMP SA.  It is created when
		phase 1 exchange on both initiator and responder side will be
		started.
		"Phase 2 handler" is to manage IPsec SAs.  It is created when
		pfkey acquire message will be received, and when 1st message
		in phase 2 will be received on responder side.
	- Vendor id will be sent after negotiating hasn algorithm.
	  When we receive vendor id before negotiating it, we use default hash
	  algorithm MD5 to check.
	- Post command deleted.
	- msgid_t delted.
	- don't release management handler.  do it only if retry will be
	  timed up.
	- separate the function of isakmp exchange.  one is to check received
	  data.  other is to reply.  the reason is for handling to resend.
	- change name "dir" to "side" in order to distinguish from policy
	  direction.
	- If initiator request PFS, but responder is not ready to do that,
	  responder stops the negotiation.  If initiator don't request PFS,
	  but responder require it, also responder stops the negotiation.

Sun Jan  9 03:03:39 2000  SUMIKAWA Munechika  <sumikawa@ebina.hitachi.co.jp>
	* freebsd3/ports/heimdal: upgrade to 0.2l.
	* freebsd3/usr.sbin/inetd: support IDENT.
	  From: Hajimu UMEMOTO <ume@mahoroba.org>

Sat Jan  8 23:53:23 JST 2000 sakane@ydc.co.jp
	* kame/sys/netkey/key.c:
	  - fix kenrel crash when flushing SAD.
	  - for stability, increment refcnt of SA when key_getsavbyspi() called.
	  - add some error message
	  - fix errno at key_update().

Sat Jan  8 04:40:33 JST 2000  itojun@iijlab.net
	* kame/sys/netinet/{frag6,ip6_input,nd6_nbr}.c:
	  use arc4random() on openbsd.  it should give better random value
	  for initializing sequence numbers.
	  From: deraadt@openbsd.org

Sat Jan  8 03:20:05 JST 2000  itojun@iijlab.net
	* /sys/netinet/udp_usrreq.c, kame/sys/netinet6/udp6_usrreq.c:
	  drop incoming udp packet with dst port = 0.  it is, or seems to be,
	  illegal based on RFC768 (99% sure but 1% in doubt).
	  with traditional 4.4BSD code, udp socket will mistakingly accept
	  such packets after socket() and before first bind()/connect().
	  this can be used to confuse, or de-synchronize, udp-based protocols.

Sat Jan  8 00:37:28 2000  Shin'ichi Fujisawa  <fujisawa@kame.net>
	* kame/sys/netinet6/natpt*.[ch]: NAT-PT translator. 
	* kame/kame/{natptconfig,natptd,natptlog}: translator configulation
	  command and natpt related commands.

	- These NAT-PT translator and commands are now under development.
	  Its user interface and overall functionality are subject to
	  future improvements and changes.  So, please be careful when you
	  try it.

	- At this time, this translator works on FreeBSD228 only.  Please
	  wait a while to works on other platforms.

Sat Jan  8 00:09:44 2000  SUMIKAWA Munechika  <sumikawa@ebina.hitachi.co.jp>
	* freebsd3/ports/openssh: upgrade to current source of OpenBSD,
	  which support IPv6 in default.  Any additional patches does not
	  neccesary anymore.

2000-01-07  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/ip6_output.c (ip6_output): do not insert a
	dest options header (even if specified by a user) that should be
	placed before a routing header, unless a routing header really
	exists.

2000-01-07  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/rtsold: use raw ip6 socket for probing interface
	status instead of a separate UDP socket, in order to avoid
	receiving unexpected UDP datagrams.
	In response to: kit/187

2000-01-06  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/icmp6.c (icmp6_input): upper layer detection
	in notifying an icmp6 error was improved:
	- if the erroneous packet contains a routing header, examine the
	header to determine the final destination and use it to update
	path MTU.
	- if the erroneous packet contains a fragment header, stop
	chasing the header chain unless it is the first fragment.

	With the former fix the kernel will perform path MTU discovery
	correctly even if triggered packets contain a routing header.

	* A new function icmp6_mtudisc_update() was added to cleanup the
	code.

Thu Jan  6 16:43:52 JST 2000  itojun@iijlab.net
	* sys/netkey/key.c: when searching IPsec SA for inbound IPsec traffic,
	  do not check src match according to RFC2401.  it looks that IPsec
	  specs do not really agree with each other about what should be
	  in IPsec SA, and what should be matched.  see comment lines near
	  key_allocsa().

Thu Jan  6 13:49:43 JST 2000  itojun@iijlab.net
	* sys/netinet6/ip6_input.c: add missing case for net.inet6.ip6.rr_prune
	  for openbsd and netbsd.
	* netbsd/pkgsrc/net/zebra, freebsd[23]/ports/zebra: upgrade to 0.83a.

Thu Jan  6 01:40:50 JST 2000  itojun@iijlab.net
	* sys/netinet6/icmp6.c: avoid panic on getsockopt(ICMPV6_FILTER).
	  From: shigeya@foretune.co.jp
	* {openbsd,bsdi4}/sys/netinet6/raw_ipv6.c: clarify rip6_ctloutput().

Wed Jan  5 19:44:12 JST 2000  itojun@iijlab.net
	* netbsd/usr.bin/systat, openbsd/usr.bin/systat:
	  make systat IPv6 ready.  "netstat" subcommand is changed for this.

Wed Jan  5 13:27:43 JST 2000  itojun@iijlab.net
	* kame/libinet6/getnameinfo.c: allow reverse lookup for v4 loopback
	  network (127.0.0.0/8).
	* kame/libinet6/rcmd.c: implement iruserok_sa().  iruserok_af() does
	  not make sense as it is not scope-aware.
	  nuke ruserok_af(), as ruserok() takes string hostname and is af
	  independent already.  we don't really need ruserok_af().
	  iruserok_af() is kept for backward compatibility.  we'll nuke it
	  afterwards.

Wed Jan  5 02:49:05 JST 2000  itojun@iijlab.net
	* netbsd: add net.inet6.ip6.bindv6only sysctl.  this is a replacement
	  of net.inet6.ip6.mapped_addr, which was bitwise opposite to
	  IPV6_BINDV6ONLY.
	  if set to 1: AF_INET6 listening socket will grab IPv6 traffic only.
	  if set to 0: AF_INET6 listening socket will grab IPv4 traffic as well,
		  as if it was from v4 mapped address (described in rfc1933).
	  default value is 1 (i.e. AF_INET6 socket grabs IPv6 traffic only).
	  the variable controls inbound direction only; you can always use
	  v4 mapped address for outgoing connections.

	  "options INET6_BINDV6ONLY" will remove the code completely and
	  hardcodes behavior to net.inet6.ip6.bindv6only=1 case.

	  "options MAPPED_ADDR_ENABLED" and net.inet6.ip6.mapped_addr were
	  obsoleted on netbsd (were introduced on Dec 21 1999).

2000-01-05  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/{bgpd, pim6[ds]d, ping6, traceroute6}: were modified
	to use rfc2292bis by default. Related Makefiles were also
	modified.

2000-01-04  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/kame/libinet6/{ip6opt.c, rthdr.c}: implemented some new
	functions introduced in rfc2292bis (see TODO.2292bis for more
	details).
	All the new functions except rcmd_af and rexec_af are now
	available.

2000-01-04  JINMEI, Tatuya  <jinmei@isl.rdc.toshiba.co.jp>
	* kame/sys/netinet6/{various files}: implemented the new advanced
	API (rfc2292bis). The kernel part is now almost finished (see
	TODO.2292bis for more details).
	
	Note about lower compatibility: I believe the new kernel is
	fairly compatible with the old API (i.e. RFC2292).

	There are few compatibility issues in interfaces using ancillary
	data. I believe the compatibility issues won't practically bother
	you.

	You don't have to care compatibility when setting a socket option
	except IPV6_HOPLIMIT. If you use the option but don't want to
	migrate to the new API, you have two choices. One is to use
	IPV6_RECVHOPLIMIT instead of IPV6_HOPLIMIT and just keep the other
	code. The other is to define COMPAT_RFC2292 in your kernel
	configuration file and recompile the kernel. Then the kernel will
	handle IPV6_HOPLIMIT in the RFC2292 manner.

	Unfortunately, it is impossible to ensure compatibility for
	getting socket options whose semantics in the new API is different
	than in RFC2292. If you don't want to use the new API but want to
	do getsockopt for such options (I believe the possibility is very
	rare, though) define COMPAT_RFC2292 in your kernel configuration
	file and recompile the kernel. Then the kernel will handle the
	options in the RFC2292 manner.

	Please note that the new API is enabled by default in any case.

Tue Jan  4 18:59:08 JST 2000 sakane@ydc.co.jp
	* kame/sys/netkey:
	  don't check sequence number at key_update() even if SA initiator.
	  don't change sequence number passed from userland at key_getspi()
	  instead of the value of sequence number.
	  They can be re-enable to define IPSEC_DOSEQCHECK.

Sun Jan  2 22:59:45 JST 2000  itojun@iijlab.net
	* kame/libinet6/name6.c: don't bark even if we see T_SIG and other
	  record types.

	  KAME PR: 184
	  From: Assar Westerlund <assar@sics.se>

Sun Jan  2 22:07:54 JST 2000  itojun@iijlab.net
	* kame/tcpdump/isakmp.h, kame/racoon/isakmp.h:
	  avoid use of bitfield on packet format definition.  it is
	  non-portable.
	* kame/Makefile.inc: added it to share definitions across top-level
	  Makefile and platform Makefile (like netbsd/Makefile).
	  NOTE: if you use anoncvs, you may need to checkout Makefile.inc
	  manually.

Sun Jan  2 03:46:57 JST 2000  itojun@iijlab.net
	* sys/netinet6/icmp6.[ch]: add net.inet6.icmp6.nodeinfo sysctl MIB,
	  which enables/disables node information query processing in the
	  kernel.

Sat Jan  1 03:02:02 JST 2000  itojun@iijlab.net
	* netbsd/usr.bin/ftp: fix "ftp URL" behavior.  it failed if the
	  specified URL is in certain condition due to bug in IPv6 support.

Sat Jan  1 JST 2000
	* happy Y2K from KAME team!
